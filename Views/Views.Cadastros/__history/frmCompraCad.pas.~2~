unit frmCompraCad;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, Vcl.Imaging.pngimage, Vcl.ExtCtrls,
  Vcl.StdCtrls, Vcl.Buttons, Data.DB, Vcl.Grids, Vcl.DBGrids, System.ImageList,
  Vcl.ImgList, Vcl.Mask, Vcl.DBCtrls, dmCompraCad;

type
  TForm2 = class(TForm)
    pnlTopo: TPanel;
    lblTITULO: TLabel;
    imgicon: TImage;
    pnlBaixo: TPanel;
    btnSalvar: TBitBtn;
    btnNovo: TBitBtn;
    btnEditar: TBitBtn;
    btnFechar: TBitBtn;
    btnCancelar: TBitBtn;
    Panel1: TPanel;
    pnlCamposBottom: TPanel;
    dbedtvalor_total: TDBEdit;
    ds: TDataSource;
    lblValorCompra: TLabel;
    lblCustoTotal: TLabel;
    dbedtcusto_total: TDBEdit;
    dbedtid_compra: TDBEdit;
    lblForncedorId: TLabel;
    dbedtid_fornecedor: TDBEdit;
    lbl: TLabel;
    edtNomeFornecedor: TEdit;
    btnFornecedor: TBitBtn;
    ilimgs: TImageList;
    dbedtdata_compra: TDBEdit;
    dbgrdCompraProd: TDBGrid;
    dsProdutosGRID: TDataSource;
    procedure dbgrdCompraProdColExit(Sender: TObject);
  private
    { Private declarations }
  public
    { Public declarations }
  end;

var
  Form2: TForm2;

implementation

{$R *.dfm}

procedure TForm2.dbgrdCompraProdColExit(Sender: TObject);
var
  NomeProduto: string;
  PrecoUnitario, CustoUnitario: Currency;
begin
  if dsProdutosGRID.State in [dsInsert, dsEdit] then
  begin
    if dbgrdCompraProd.SelectedIndex = 0 then
    begin
      DMCompra.BuscarProdutoPorID(dbgrdCompraProd.Fields[0].AsInteger, NomeProduto, PrecoUnitario, CustoUnitario);

      if NomeProduto <> '' then
      begin
        dbgrdCompraProd.Fields[1].AsString := NomeProduto;
        dbgrdCompraProd.Fields[3].AsCurrency := PrecoUnitario;
        dbgrdCompraProd.Fields[4].AsCurrency := CustoUnitario;
      end
      else
      begin
        ShowMessage('Produto não encontrado!');
      end;
    end;
  end;
end;


end.
